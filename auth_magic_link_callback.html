<!doctype html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Xác thực đăng nhập - SVP</title>
    <link rel="icon" type="image/svg+xml" href="assets/icons/favicon.svg">
    <link rel="shortcut icon" href="assets/icons/favicon.svg">
    <style>
        body { margin: 0; min-height: 100vh; display: grid; place-items: center; font-family: Arial, sans-serif; background: #f8fafc; color: #0f172a; }
        .box { width: min(520px, 92vw); background: #fff; border: 1px solid #e2e8f0; border-radius: 12px; padding: 20px; text-align: center; }
        .spinner { width: 28px; height: 28px; border: 3px solid #dbeafe; border-top-color: #2563eb; border-radius: 50%; margin: 0 auto 10px; animation: spin .8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .err { color: #b91c1c; }
    </style>
</head>
<body>
<div class="box">
    <div class="spinner"></div>
    <h1 style="font-size:20px; margin:0 0 8px;">Đang xác thực đăng nhập</h1>
    <p id="msg" style="margin:0;">Vui lòng đợi, hệ thống đang hoàn tất phiên đăng nhập...</p>
</div>
<script>
(() => {
    const msg = document.getElementById('msg');
    const params = new URLSearchParams((window.location.hash || '').replace(/^#/, ''));
    const accessToken = params.get('accessToken') || '';
    const refreshToken = params.get('refreshToken') || '';
    const email = params.get('email') || '';
    const nickname = params.get('nickname') || '';
    const userId = params.get('userId') || '';

    if (!accessToken || !refreshToken) {
        msg.textContent = 'Không tìm thấy token đăng nhập. Vui lòng thử lại magic link.';
        msg.className = 'err';
        return;
    }

    localStorage.setItem('accessToken', accessToken);
    localStorage.setItem('refreshToken', refreshToken);
    if (email) localStorage.setItem('userEmail', email);
    if (nickname) localStorage.setItem('userNickname', nickname);
    if (userId) localStorage.setItem('userId', userId);

    msg.textContent = 'Đăng nhập thành công. Đang chuyển về trang chủ...';
    setTimeout(() => {
        window.location.replace('index.html');
    }, 500);
})();
</script>
</body>
</html>



