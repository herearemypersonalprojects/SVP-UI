<!doctype html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Diễn đàn Sinh viên & Tri thức Việt tại Pháp (SVP)</title>
    <link rel="icon" type="image/svg+xml" href="assets/icons/favicon.svg">
    <link rel="shortcut icon" href="assets/icons/favicon.svg">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="svp.css">
</head>
<body>
<!-- Top brand + auth -->
<div class="sv-topbar pt-2 pb-1">
    <div class="container d-flex align-items-center justify-content-between">
        <div class="sv-brand">
            <img class="sv-brand__logo-img" src="assets/icons/logo_svp.png" alt="SVP" width="102" height="112" />
            <div class="sv-brand__title">
                <h1>DIỄN ĐÀN SINH VIÊN & TRI THỨC VIỆT TẠI PHÁP <span class="sv-brand__accent">(SVP)</span></h1>
                <div class="sv-brand__divider"></div>
                <small class="sv-brand__tagline">Kết Nối – Chia Sẻ – Thành Công</small>
            </div>
        </div>

        <div id="sv-auth-box" class="sv-auth d-none d-md-flex align-items-center gap-2">
            <a class="btn btn-outline-secondary" href="signup.html">Đăng Ký</a>
            <a class="btn btn-primary" href="login.html">Đăng Nhập</a>
        </div>
    </div>
</div>

<!-- Main nav -->
<div class="sv-nav">
    <div class="container d-flex align-items-center justify-content-between">
        <ul class="nav">
            <li class="nav-item"><a class="nav-link" href="index.html">Trang Chủ</a></li>
            <li class="nav-item"><a class="nav-link" href="forum.html">Diễn Đàn</a></li>
            <li class="nav-item"><a class="nav-link" href="categories.html">Khám Phá Chủ Đề</a></li>
            <li class="nav-item"><a class="nav-link active" href="events.html">Sự Kiện & Lễ Hội</a></li>
            <li class="nav-item"><a class="nav-link" href="ban-do-paris.html">Bản Đồ Paris</a></li>
            <li class="nav-item"><a class="nav-link" href="about.html">Giới Thiệu</a></li>
        </ul>

        <div class="sv-search position-relative my-2 my-md-0" style="width:min(320px, 60vw);">
            <i class="fa fa-magnifying-glass"></i>
            <input class="form-control" type="search" placeholder="Tìm kiếm..." />
        </div>
    </div>
</div>
<main class="container my-4">
    <div class="sv-card mb-3">
        <div class="sv-card__hd d-flex flex-wrap justify-content-between align-items-center gap-2">
            <span><i class="fa-solid fa-calendar-days me-2 text-primary"></i>Tất cả sự kiện</span>
            <a class="btn btn-sm btn-primary" href="create_new_event.html">
                <i class="fa-solid fa-plus me-1"></i>Tạo sự kiện mới
            </a>
        </div>

        <div class="p-3">
            <ul class="nav nav-tabs mb-3" id="eventTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="upcoming-tab" data-bs-toggle="tab" data-bs-target="#upcoming" type="button" role="tab" aria-controls="upcoming" aria-selected="true">Sự kiện sẽ diễn ra</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="past-tab" data-bs-toggle="tab" data-bs-target="#past" type="button" role="tab" aria-controls="past" aria-selected="false">Sự kiện đã qua</button>
                </li>
            </ul>

            <div class="tab-content" id="eventTabsContent">
                <div class="tab-pane fade show active" id="upcoming" role="tabpanel" aria-labelledby="upcoming-tab" tabindex="0">
                    <ul id="sv-events-upcoming-list" class="sv-list mb-0" aria-live="polite"></ul>
                </div>

                <div class="tab-pane fade" id="past" role="tabpanel" aria-labelledby="past-tab" tabindex="0">
                    <ul id="sv-events-past-list" class="sv-list mb-0" aria-live="polite"></ul>
                </div>
            </div>
        </div>
    </div>
</main>

<footer class="container py-4">
    <div class="row">
        <div class="col-md">
            <div class="sv-brand d-flex align-items-center mb-2">
                <div class="sv-brand__logo" style="width:36px; height:36px; font-size:14px;">SVP</div>
                <strong class="ms-2">SVP - Kết Nối • Chia Sẻ • Thành Công</strong>
            </div>
            <div>© 2026 SVP. Mọi quyền được bảo lưu.</div>
        </div>
        <div class="col-md text-md-end mt-2 mt-md-0">
            <a class="me-3" href="/terms.html">Điều khoản</a>
            <a class="me-3" href="/security.html">Bảo mật</a>
            <a href="/contact.html">Liên hệ</a>
        </div>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    (function () {
        const API_BASE_URL = window.SVP_API_BASE_URL || 'http://localhost:8080';
        const upcomingList = document.getElementById('sv-events-upcoming-list');
        const pastList = document.getElementById('sv-events-past-list');
        if (!upcomingList || !pastList) {
            return;
        }

        const escapeHtml = (value) => String(value || '')
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&#039;');

        const toTimeValue = (value) => {
            const time = Date.parse(String(value || ''));
            return Number.isFinite(time) ? time : 0;
        };

        const formatDate = (value) => {
            const time = toTimeValue(value);
            if (!time) {
                return 'Chưa cập nhật';
            }
            return new Intl.DateTimeFormat('vi-VN', {
                dateStyle: 'short',
                timeStyle: 'short'
            }).format(new Date(time));
        };

        const toBadge = (event, isPast) => {
            if (isPast) {
                return 'Đã kết thúc';
            }
            const rawPrice = Number(event.price);
            if (Number.isFinite(rawPrice) && rawPrice > 0) {
                return `${rawPrice.toLocaleString('vi-VN')}€`;
            }
            return event.online ? 'Online' : 'Free';
        };

        const renderEventItem = (event, isPast) => {
            const title = escapeHtml(event.title || 'Sự kiện mới');
            const eventId = encodeURIComponent(event.eventId || '');
            const href = `event_detail.html?eventId=${eventId}`;
            const date = escapeHtml(formatDate(event.eventTime));
            const address = escapeHtml(event.address || (event.online ? 'Online' : 'Địa điểm cập nhật sau'));
            const badge = escapeHtml(toBadge(event, isPast));
            const iconClass = isPast ? 'fa-regular fa-calendar-check' : 'fa fa-calendar-day';
            return `
                <li>
                    <div>
                        <a href="${href}"><i class="${iconClass} me-2 text-primary"></i>${title}</a>
                        <div class="sv-meta">${date} • ${address}</div>
                    </div>
                    <span class="sv-badge">${badge}</span>
                </li>
            `;
        };

        const renderList = (target, items, isPast, emptyMessage) => {
            if (!Array.isArray(items) || items.length === 0) {
                target.innerHTML = `<li><div class="sv-meta">${escapeHtml(emptyMessage)}</div></li>`;
                return;
            }
            target.innerHTML = items.map((event) => renderEventItem(event, isPast)).join('');
        };

        const fetchEvents = async () => {
            const response = await fetch(`${API_BASE_URL}/events?limit=200`, {
                method: 'GET',
                headers: { Accept: 'application/json' }
            });
            const payload = await response.json().catch(() => ({}));
            if (!response.ok) {
                throw new Error(payload.error || 'Không thể tải danh sách sự kiện.');
            }
            return Array.isArray(payload.items) ? payload.items : [];
        };

        const loadEvents = async () => {
            upcomingList.innerHTML = '<li><div class="sv-meta">Đang tải sự kiện...</div></li>';
            pastList.innerHTML = '<li><div class="sv-meta">Đang tải sự kiện...</div></li>';
            try {
                const events = await fetchEvents();
                const now = Date.now();
                const upcoming = events
                    .filter((event) => {
                        const time = toTimeValue(event.eventTime);
                        return time >= now;
                    })
                    .sort((left, right) => toTimeValue(left.eventTime) - toTimeValue(right.eventTime));
                const past = events
                    .filter((event) => {
                        const time = toTimeValue(event.eventTime);
                        return time > 0 && time < now;
                    })
                    .sort((left, right) => toTimeValue(right.eventTime) - toTimeValue(left.eventTime));

                renderList(upcomingList, upcoming, false, 'Chưa có sự kiện sắp diễn ra.');
                renderList(pastList, past, true, 'Chưa có sự kiện đã qua.');
            } catch (error) {
                console.error('Cannot load events:', error);
                const message = error && error.message ? error.message : 'Không thể tải danh sách sự kiện.';
                upcomingList.innerHTML = `<li><div class="sv-meta">${escapeHtml(message)}</div></li>`;
                pastList.innerHTML = `<li><div class="sv-meta">${escapeHtml(message)}</div></li>`;
            }
        };

        loadEvents();
    })();
</script>
<script src="auth-topbar.js"></script>
</body>
</html>










